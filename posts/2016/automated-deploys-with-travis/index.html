<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="/phenomic.browser.2d7fb483b27709f964f7.css" /><meta data-react-helmet="true" name="generator" content="Phenomic 0.17.12"/><meta data-react-helmet="true" property="og:site_name" content="blog-timscanlin-net"/><meta data-react-helmet="true" name="twitter:site" content="@tim_scanlin"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Automated Deploys With Travis"/><meta data-react-helmet="true" property="og:url" content="http://blog.timscanlin.net/posts/2016/automated-deploys-with-travis/"/><meta data-react-helmet="true" property="og:description" content="Using Travis CI is a great way to automate repetitive tasks like building and testing your projects. But recently I&#x27;ve been using it to…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Automated Deploys With Travis"/><meta data-react-helmet="true" name="twitter:creator" content="@tim_scanlin"/><meta data-react-helmet="true" name="twitter:description" content="Using Travis CI is a great way to automate repetitive tasks like building and testing your projects. But recently I&#x27;ve been using it to…"/><meta data-react-helmet="true" name="description" content="Using Travis CI is a great way to automate repetitive tasks like building and testing your projects. But recently I&#x27;ve been using it to…"/><title data-react-helmet="true">Automated Deploys With Travis</title></head><body><div id="phenomic"><div class="_2Mf6m" data-reactroot="" data-reactid="1" data-react-checksum="-126258917"><div hidden="" data-reactid="2"><!-- react-empty: 3 --><!-- react-empty: 4 --><style data-reactid="5">@-ms-viewport { width: device-width; }</style></div><header data-reactid="6"><nav style="background-color:rgba(250,250,255,0);" class="mw8 center tc pv3" data-reactid="7"><div class="dib w-100 pa2" data-reactid="8"><a class="f2 no-underline black" href="/" data-reactid="9">Tim Scanlin</a></div><div class="dib w-100" data-reactid="10"><a class="pa1 mh1" href="/" data-reactid="11">Blog</a><a class="pa1 mh1" href="http://timscanlin.net" data-reactid="12">About</a><a class="pa1 mh1" href="https://github.com/tscanlin/" data-reactid="13">Github</a></div></nav></header><div class="_116Tm" data-reactid="14"><div class="mw6 center" data-reactid="15"><!-- react-empty: 16 --><h1 data-reactid="17">Automated Deploys With Travis</h1><header data-reactid="18"><time data-reactid="19">Oct 28 2016</time></header><div class="phenomic-BodyContainer" data-reactid="20"><p>Using <a href="https://travis-ci.org/">Travis CI</a> is a great way to automate repetitive tasks like building and testing your projects. But recently I've been using it to automate deployments to github pages and it's been great. I have read a <a href="https://medium.com/@nthgergo/publishing-gh-pages-with-travis-ci-53a8270e87db#.2mit50e96">few</a> <a href="https://gist.github.com/domenic/ec8b0fc8ab45f39403dd">tutorials</a> <a href="http://www.steveklabnik.com/automatically_update_github_pages_with_travis_example/">that</a> outlined similar steps, but they didn't quite have the results I wanted so I decided to write my own. To automate deploying to github pages with <a href="https://travis-ci.org/">Travis</a>, here's the steps I followed:</p>
<ol>
<li>
<p><a href="https://github.com/settings/tokens">Get a personal access token from github.com</a> Note: You only get to see this key once.</p>
</li>
<li>
<p>Setup your repository in Travis (at <a href="https://travis-ci.org/">https://travis-ci.org/</a>)
I also suggest limiting concurrent builds to 1 in the repo's Travis settings so that builds run sequentially.</p>
</li>
<li>
<p><code>npm install -g travis-encrypt</code> (<a href="https://www.npmjs.com/package/travis-encrypt">https://www.npmjs.com/package/travis-encrypt</a>)</p>
</li>
<li>
<p><code>travis-encrypt -r [repository slug] GITHUB_TOKEN=[personal access token]</code> Note: The repository slug includes your username.</p>
</li>
</ol>
<ol start="5">
<li>Then setup your .travis.yml file, you need to changes the <code>GITHUB_REPO</code> and <code>secure</code> options.</li>
</ol>
<pre><code class="hljs language-yaml"><span class="hljs-attr">language:</span> node_js
<span class="hljs-attr">node_js:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">"6.9"</span>
<span class="hljs-attr">sudo:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">branches:</span>
<span class="hljs-attr">  only:</span>
<span class="hljs-bullet">    -</span> master
<span class="hljs-attr">install:</span>
<span class="hljs-bullet">-</span> npm install
<span class="hljs-attr">script:</span>
<span class="hljs-bullet">-</span> npm run build
<span class="hljs-attr">after_success:</span>
<span class="hljs-bullet">-</span> bash ./travis-deploy.sh
<span class="hljs-attr">env:</span>
<span class="hljs-attr">  global:</span>
<span class="hljs-attr">    - GITHUB_REPO:</span> [repository slug]
<span class="hljs-attr">    - secure:</span> [result from travis-encrypt command]</code></pre>
<ol start="6">
<li>And include the travis-deploy script:</li>
</ol>
<pre><code class="hljs language-sh"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -o errexit

<span class="hljs-comment"># Info.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Running deploy script"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Branch: <span class="hljs-variable">$TRAVIS_BRANCH</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Is a Pull Request: <span class="hljs-variable">$TRAVIS_PULL_REQUEST</span>"</span>

<span class="hljs-comment"># Exit if the branch is not the master branch.</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$TRAVIS_BRANCH</span>"</span> != <span class="hljs-string">"master"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"This commit was made against the <span class="hljs-variable">$TRAVIS_BRANCH</span> and not the master. No deploy."</span>
  <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Exit if the commit is a pull request.</span>
<span class="hljs-comment"># We only want to build / deploy when pull requests are merged into master.</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$TRAVIS_PULL_REQUEST</span>"</span> != <span class="hljs-string">"false"</span> ]
<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"This commit is a pull request. No deploy."</span>
  <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># Git config.</span>
git config --global user.email <span class="hljs-string">"nobody@nobody.org"</span>
git config --global user.name <span class="hljs-string">"Travis CI"</span>

<span class="hljs-comment"># Build steps (taken care of beforehand)</span>

<span class="hljs-comment"># Deploy.</span>
<span class="hljs-built_in">cd</span> build
git init
git add .
git commit -m <span class="hljs-string">"Deploy to Github Pages"</span>
git push --force --quiet <span class="hljs-string">"https://<span class="hljs-variable">${GITHUB_TOKEN}</span>@github.com/<span class="hljs-variable">${GITHUB_REPO}</span>.git"</span> master:gh-pages > /dev/null 2>&#x26;1</code></pre>
<ol start="7">
<li>Also, make the <code>gh-pages</code> branch on github before running the above script from travis-ci just to be safe.</li>
</ol>
<p>This will deploy to the gh-pages branch on any commits into master as long as the build finishes successfully [even if not done through a pull request in case of emergencies ;)]. On pull requests, travis will still try and build the branch to make sure that succeeds, but it won't push any of the changes to gh-pages branch.</p>
<p>See this in action in the github repo for this blog at  <a href="https://github.com/tscanlin/blog.timscanlin.net">https://github.com/tscanlin/blog.timscanlin.net</a></p>
</div></div></div><footer class="center w5 f6 tc bt b--light-gray mt4" data-reactid="21"><p data-reactid="22"><a href="/feed.xml" data-reactid="23">feed</a></p><p data-reactid="24"><span data-reactid="25">© </span><span data-reactid="26"><!-- react-text: 27 -->2017<!-- /react-text --><!-- react-text: 28 --> <!-- /react-text --></span><span data-reactid="29">Tim Scanlin</span></p></footer></div></div><script>window.__COLLECTION__ = [{"layout":"PageError","route":"404.html","description":"Content here not used, see src/layouts/PageError","__filename":"404.md","__url":"/404.html","__resourceUrl":"/404.html","__dataUrl":"/404.html.c51e41dcf93740dd221b7da7702623a9.json"},{"title":"Tim Scanlin's Blog","layout":"Homepage","hideTitle":true,"description":"","__filename":"index.md","__url":"/","__resourceUrl":"/index.html","__dataUrl":"/index.html.6c43ca9d944e05faefa5375cacab486f.json"},{"layout":"PageLoading","description":"Content here not used, see src/layouts/PageLoading. This page is a demo for loading state. You can safely delete if you want.","__filename":"loading.md","__url":"/loading/","__resourceUrl":"/loading/index.html","__dataUrl":"/loading/index.html.195d4f0e5d27a11e56d8db059f891663.json"},{"title":"Simple d3.js Visualization Tutorial","layout":"Post","date":"2014-08-30T00:00:00.000Z","draft":false,"summary":"d3.js is an awesome JavaScript library that's perfect for visualizing data. However, it has a reputation for being a bit tricky to learn; but once you understand the basics, you can actually make some really cool stuff.","description":"d3.js is an awesome JavaScript library that's perfect for visualizing data. However, it has a reputation for being a bit tricky to learn;…","__filename":"posts/2014/Simple-d3-js-visualization.md","__url":"/posts/2014/Simple-d3-js-visualization/","__resourceUrl":"/posts/2014/Simple-d3-js-visualization/index.html","__dataUrl":"/posts/2014/Simple-d3-js-visualization/index.html.38597d37850963f07f2d05e0157c31b0.json"},{"title":"5 Tips for New Web Developers","layout":"Post","date":"2014-07-18T00:00:00.000Z","paths":[{"path":"/blog/2014/5-Tips-for-New-Web-Developers","buildHtml":true},{"path":"/2014/07/18/5-Tips-for-New-Web-Developers"}],"draft":false,"tags":"example","summary":"I have dabbled in HTML, JavaScript, and programming in general for a little over a decade now. In the beginning it was very overwhelming, it seemed like there was so much to learn that it would be an impossible task.","description":"However, I enjoy learning, and bit by bit, I started reading and going through tutorials to understand the basics of coding. This got me…","__filename":"posts/2014/Tips-for-New-Web-Developers.md","__url":"/posts/2014/Tips-for-New-Web-Developers/","__resourceUrl":"/posts/2014/Tips-for-New-Web-Developers/index.html","__dataUrl":"/posts/2014/Tips-for-New-Web-Developers/index.html.1afb083d694e2180815c3286890eab19.json"},{"title":"Login Bash Script","layout":"Post","date":"2015-09-30T00:00:00.000Z","paths":[{"path":"/blog/2015/login-bash-script","buildHtml":true},{"path":"/2015/09/30/login-bash-script","buildHtml":true}],"draft":false,"summary":"JavaScript is my happy place. It's the language I'm most comfortable in and I really enjoy using it both in the browser and with node.js even though it has a number of <a href=\"https://www.pubnub.com/blog/kyle-simpson-asks-javascript-wtf/\">weird quirks</a>.","description":"JavaScript is my happy place. It's the language I'm most comfortable in and I really enjoy using it both in the browser and with node.js…","__filename":"posts/2015/login-bash-script.md","__url":"/posts/2015/login-bash-script/","__resourceUrl":"/posts/2015/login-bash-script/index.html","__dataUrl":"/posts/2015/login-bash-script/index.html.dcf63cffd6a67febc3b339296777d96c.json"},{"title":"Automated Deploys With Travis","layout":"Post","date":"2016-10-28T00:00:00.000Z","description":"Using Travis CI is a great way to automate repetitive tasks like building and testing your projects. But recently I've been using it to…","__filename":"posts/2016/automated-deploys-with-travis.md","__url":"/posts/2016/automated-deploys-with-travis/","__resourceUrl":"/posts/2016/automated-deploys-with-travis/index.html","__dataUrl":"/posts/2016/automated-deploys-with-travis/index.html.789bb3ec8691a1a3ba3bc05b6b8f1240.json"},{"title":"Open Source Projects in 2016","layout":"Post","date":"2016-12-27T00:00:00.000Z","description":"2016 has been full of many ups and downs, but at least I was able to launch a couple of small open source projects this year. The projects…","__filename":"posts/2016/open-source-projects-in-2016.md","__url":"/posts/2016/open-source-projects-in-2016/","__resourceUrl":"/posts/2016/open-source-projects-in-2016/index.html","__dataUrl":"/posts/2016/open-source-projects-in-2016/index.html.c915b9f1fb6fc856dc2d174a3445d5f0.json"}];window.__INITIAL_STATE__ = {"pages":{"/posts/2016/automated-deploys-with-travis/":{"head":{"title":"Automated Deploys With Travis","layout":"Post","date":"2016-10-28T00:00:00.000Z","description":"Using Travis CI is a great way to automate repetitive tasks like building and testing your projects. But recently I've been using it to…"},"body":"<p>Using <a href=\"https://travis-ci.org/\">Travis CI</a> is a great way to automate repetitive tasks like building and testing your projects. But recently I've been using it to automate deployments to github pages and it's been great. I have read a <a href=\"https://medium.com/@nthgergo/publishing-gh-pages-with-travis-ci-53a8270e87db#.2mit50e96\">few</a> <a href=\"https://gist.github.com/domenic/ec8b0fc8ab45f39403dd\">tutorials</a> <a href=\"http://www.steveklabnik.com/automatically_update_github_pages_with_travis_example/\">that</a> outlined similar steps, but they didn't quite have the results I wanted so I decided to write my own. To automate deploying to github pages with <a href=\"https://travis-ci.org/\">Travis</a>, here's the steps I followed:</p>\n<ol>\n<li>\n<p><a href=\"https://github.com/settings/tokens\">Get a personal access token from github.com</a> Note: You only get to see this key once.</p>\n</li>\n<li>\n<p>Setup your repository in Travis (at <a href=\"https://travis-ci.org/\">https://travis-ci.org/</a>)\nI also suggest limiting concurrent builds to 1 in the repo's Travis settings so that builds run sequentially.</p>\n</li>\n<li>\n<p><code>npm install -g travis-encrypt</code> (<a href=\"https://www.npmjs.com/package/travis-encrypt\">https://www.npmjs.com/package/travis-encrypt</a>)</p>\n</li>\n<li>\n<p><code>travis-encrypt -r [repository slug] GITHUB_TOKEN=[personal access token]</code> Note: The repository slug includes your username.</p>\n</li>\n</ol>\n<ol start=\"5\">\n<li>Then setup your .travis.yml file, you need to changes the <code>GITHUB_REPO</code> and <code>secure</code> options.</li>\n</ol>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">language:</span> node_js\n<span class=\"hljs-attr\">node_js:</span>\n<span class=\"hljs-bullet\">  -</span> <span class=\"hljs-string\">\"6.9\"</span>\n<span class=\"hljs-attr\">sudo:</span> <span class=\"hljs-literal\">false</span>\n<span class=\"hljs-attr\">branches:</span>\n<span class=\"hljs-attr\">  only:</span>\n<span class=\"hljs-bullet\">    -</span> master\n<span class=\"hljs-attr\">install:</span>\n<span class=\"hljs-bullet\">-</span> npm install\n<span class=\"hljs-attr\">script:</span>\n<span class=\"hljs-bullet\">-</span> npm run build\n<span class=\"hljs-attr\">after_success:</span>\n<span class=\"hljs-bullet\">-</span> bash ./travis-deploy.sh\n<span class=\"hljs-attr\">env:</span>\n<span class=\"hljs-attr\">  global:</span>\n<span class=\"hljs-attr\">    - GITHUB_REPO:</span> [repository slug]\n<span class=\"hljs-attr\">    - secure:</span> [result from travis-encrypt command]</code></pre>\n<ol start=\"6\">\n<li>And include the travis-deploy script:</li>\n</ol>\n<pre><code class=\"hljs language-sh\"><span class=\"hljs-meta\">#!/bin/bash</span>\n<span class=\"hljs-built_in\">set</span> -o errexit\n\n<span class=\"hljs-comment\"># Info.</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Running deploy script\"</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Branch: <span class=\"hljs-variable\">$TRAVIS_BRANCH</span>\"</span>\n<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"Is a Pull Request: <span class=\"hljs-variable\">$TRAVIS_PULL_REQUEST</span>\"</span>\n\n<span class=\"hljs-comment\"># Exit if the branch is not the master branch.</span>\n<span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$TRAVIS_BRANCH</span>\"</span> != <span class=\"hljs-string\">\"master\"</span> ]\n<span class=\"hljs-keyword\">then</span>\n  <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"This commit was made against the <span class=\"hljs-variable\">$TRAVIS_BRANCH</span> and not the master. No deploy.\"</span>\n  <span class=\"hljs-built_in\">exit</span> 0\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># Exit if the commit is a pull request.</span>\n<span class=\"hljs-comment\"># We only want to build / deploy when pull requests are merged into master.</span>\n<span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-string\">\"<span class=\"hljs-variable\">$TRAVIS_PULL_REQUEST</span>\"</span> != <span class=\"hljs-string\">\"false\"</span> ]\n<span class=\"hljs-keyword\">then</span>\n  <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">\"This commit is a pull request. No deploy.\"</span>\n  <span class=\"hljs-built_in\">exit</span> 0\n<span class=\"hljs-keyword\">fi</span>\n\n<span class=\"hljs-comment\"># Git config.</span>\ngit config --global user.email <span class=\"hljs-string\">\"nobody@nobody.org\"</span>\ngit config --global user.name <span class=\"hljs-string\">\"Travis CI\"</span>\n\n<span class=\"hljs-comment\"># Build steps (taken care of beforehand)</span>\n\n<span class=\"hljs-comment\"># Deploy.</span>\n<span class=\"hljs-built_in\">cd</span> build\ngit init\ngit add .\ngit commit -m <span class=\"hljs-string\">\"Deploy to Github Pages\"</span>\ngit push --force --quiet <span class=\"hljs-string\">\"https://<span class=\"hljs-variable\">${GITHUB_TOKEN}</span>@github.com/<span class=\"hljs-variable\">${GITHUB_REPO}</span>.git\"</span> master:gh-pages > /dev/null 2>&#x26;1</code></pre>\n<ol start=\"7\">\n<li>Also, make the <code>gh-pages</code> branch on github before running the above script from travis-ci just to be safe.</li>\n</ol>\n<p>This will deploy to the gh-pages branch on any commits into master as long as the build finishes successfully [even if not done through a pull request in case of emergencies ;)]. On pull requests, travis will still try and build the branch to make sure that succeeds, but it won't push any of the changes to gh-pages branch.</p>\n<p>See this in action in the github repo for this blog at  <a href=\"https://github.com/tscanlin/blog.timscanlin.net\">https://github.com/tscanlin/blog.timscanlin.net</a></p>\n","__filename":"posts/2016/automated-deploys-with-travis.md","__url":"/posts/2016/automated-deploys-with-travis/","__resourceUrl":"/posts/2016/automated-deploys-with-travis/index.html","__dataUrl":"/posts/2016/automated-deploys-with-travis/index.html.789bb3ec8691a1a3ba3bc05b6b8f1240.json","type":"Post"}}}</script><script data-react-helmet="true" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script><script src="/phenomic.browser.2d7fb483b27709f964f7.js"></script></body></html>