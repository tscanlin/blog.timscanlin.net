{"head":{"title":"Simple d3.js Visualization Tutorial","layout":"Post","date":"2014-08-30T00:00:00.000Z","draft":false,"summary":"d3.js is an awesome JavaScript library that's perfect for visualizing data. However, it has a reputation for being a bit tricky to learn; but once you understand the basics, you can actually make some really cool stuff.","description":"d3.js is an awesome JavaScript library that's perfect for visualizing data. However, it has a reputation for being a bit tricky to learn;â€¦"},"body":"<p>d3.js is an awesome JavaScript library that's perfect for visualizing data. However, it has a reputation for being a bit tricky to learn; but once you understand the basics, you can actually make some really cool stuff. In this tutorial, we'll be making a visualization of colored wavvy lines using some randomly generated data while also demonstrating how d3 <a href=\"https://github.com/mbostock/d3/wiki/Transitions#d3_interpolate\">interpolation</a> and <a href=\"https://github.com/mbostock/d3/wiki/Transitions\">transitions</a> work. Check out <a href=\"http://timscanlin.net\">timscanlin.net</a> to see the effect.</p>\n<p>I'll assume you have an intermediate understanding of JavaScript and jQuery (If you don't, check out <a href=\"https://dash.generalassemb.ly/\">Dash</a>) and although knowledge of <a href=\"http://d3js.org/\">d3.js</a> isn't required it is recommended that you familiarize yourself with it before starting. Now, head over to my github to <a href=\"https://github.com/tscanlin/timscanlin-demos\">download the tutorial files</a> and let's get started!</p>\n<p>To start off we will setup our empty HTML document with a single svg element with an id of 'background' and a script tag below that. Up in the head we'll add a title, style, and script tags with the script tag's source set to 'd3.min.js'.</p>\n<pre><code class=\"hljs language-html\"><span class=\"hljs-meta\">&#x3C;!DOCTYPE html></span>\n<span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">html</span>></span>\n  <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">head</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">title</span>></span>d3 Visualization<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">title</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">style</span>></span><span class=\"null\"></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">style</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"d3.min.js\"</span>></span><span class=\"null\"></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">script</span>></span>\n  <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">head</span>></span>\n\n  <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">body</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">svg</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"background\"</span>></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">svg</span>></span>\n    <span class=\"hljs-tag\">&#x3C;<span class=\"hljs-name\">script</span>></span><span class=\"null\"></span><span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">script</span>></span>\n  <span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">body</span>></span>\n<span class=\"hljs-tag\">&#x3C;/<span class=\"hljs-name\">html</span>></span></code></pre>\n<p>Then add the following CSS to the style tag you just made. This will make the html document and the svg background have 100% height and width in addition to removing the default fill that path elements have by default.</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-tag\">html</span>, <span class=\"hljs-selector-tag\">body</span> {\n  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;\n  <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">overflow</span>: hidden;\n  <span class=\"hljs-attribute\">padding</span>: <span class=\"hljs-number\">0</span>;\n}\n\n<span class=\"hljs-selector-id\">#background</span> {\n  <span class=\"hljs-attribute\">bottom</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;\n  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">position</span>: absolute;\n  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">100%</span>;\n}\n\n<span class=\"hljs-comment\">/* SVG styles */</span>\n<span class=\"hljs-selector-id\">#background</span> <span class=\"hljs-selector-tag\">path</span> {\n  <span class=\"hljs-attribute\">fill</span>: none;\n}</code></pre>\n<p>Now, let's get into the javascript. First we are going to declare some variables at the top of the script tag you added in the body.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">var</span> svg = d3.select(<span class=\"hljs-string\">'#background'</span>),\n    quantity = <span class=\"hljs-number\">7</span>,\n    points = <span class=\"hljs-number\">4</span>;</code></pre>\n<p>Here we are selecting the background svg element we added before, using d3.select(). Then we are declaring two constants, one for the quantity of lines we will have, and another for the number of points going across the screen. You can come back and play with changing these values later.</p>\n<p>Since d3.js operates on data, we are going to need to generate some data to use for this.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">generateData</span>(<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-keyword\">return</span> d3.range(points).map(getCoordinates);\n};\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getCoordinates</span>(<span class=\"hljs-params\">i</span>) </span>{\n  <span class=\"hljs-keyword\">var</span> x = i * (<span class=\"hljs-number\">1</span> / (points - <span class=\"hljs-number\">1</span>)) * <span class=\"hljs-built_in\">window</span>.innerWidth;\n  <span class=\"hljs-keyword\">var</span> y = <span class=\"hljs-built_in\">Math</span>.random() * (<span class=\"hljs-built_in\">window</span>.innerHeight / <span class=\"hljs-number\">2</span>);\n  <span class=\"hljs-keyword\">return</span> {<span class=\"hljs-attr\">x</span>: x, <span class=\"hljs-attr\">y</span>: y};\n};\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getHue</span>(<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">Math</span>.random() * <span class=\"hljs-number\">360</span>;\n};\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getStroke</span>(<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-keyword\">return</span> (<span class=\"hljs-built_in\">Math</span>.random()) * <span class=\"hljs-number\">3</span>;\n};</code></pre>\n<p>The first function, generateData(), is just using d3.range() to make an array, and .map() on that to call the getCoordinates() function for each of the points across the screen.</p>\n<p>Then, getCoordinates() is spacing the points out evenly across the window's width, and making their high somewhere in the top half of the window and using Math.random(). This is what gives the lines their waviness.</p>\n<p>The last two, getHue() and getStroke() are just randomly picking numbers for hue and stroke thickness respectively.</p>\n<p>Now lets start getting into interpolation.. it's actually not as difficult to understand as you might think. You know what <em>extrapolation</em> is right? <a href=\"http://en.wikipedia.org/wiki/Extrapolation\">Extrapolation</a> is generally estimating and looking beyond or outside what has happened to try and predict what might happen, whereas <a href=\"http://en.wikipedia.org/wiki/Interpolation\">Interpolation</a> is looking inside to find all of the possible data points between a set of known data points.</p>\n<p>So now that you understand what interpolation means, lets get into an example.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">var</span> line = d3.svg.line()\n  .interpolate(<span class=\"hljs-string\">'cardinal'</span>)\n  .x(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">d</span>) </span>{ <span class=\"hljs-keyword\">return</span> d.x; })\n  .y(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">d</span>) </span>{ <span class=\"hljs-keyword\">return</span> d.y; });</code></pre>\n<p>In the above code, we are basically creating a line constructor that tells d3.js how our line data is stored (using the same x and y properties from our getCoordinates generator before). This is also using the 'cardinal' line interpolation, to read more about d3.js line interpolation you should definitely check out this article from <a href=\"https://www.dashingd3js.com/svg-paths-and-d3js\">Dashing d3.js</a>.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">var</span> paths = svg.selectAll(<span class=\"hljs-string\">'path'</span>)\n  .data(d3.range(quantity))\n  .enter()\n  .append(<span class=\"hljs-string\">'path'</span>);</code></pre>\n<p>Now, we use the svg selection from before to select all of the path elements (even though they don't really exist yet, kinda weird, but you'll get used to it). and set the paths data() using d3.range(quantity) to return an array of 1 to 7 for each path element to be added. And finally .enter() and .append('path') to add the 7 path elements to the svg. If you reload the page now it should still look blank, but examine the source code and you should see 7 path elements in your svg element.</p>\n<p>Now, let's make one of the lines appear by adding data to one of the path elements.</p>\n<pre><code class=\"hljs language-js\">d3.select(paths[<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>])\n  .data([generateData()])\n  .attr(<span class=\"hljs-string\">'d'</span>, line)\n  .attr(<span class=\"hljs-string\">'stroke'</span>, <span class=\"hljs-string\">'hsla('</span>+getHue()+<span class=\"hljs-string\">', 80%, 50%, 0.5)'</span>)\n  .attr(<span class=\"hljs-string\">'stroke-width'</span>, getStroke());</code></pre>\n<p>Here, we are selecting one of the path elements and generating data for it. In addition to the path's data points, we are also generating a hue and stroke for it. Reload the page and you should see a single colored line. This handles one of the lines, now let's do the rest of them, this is where it all comes together. Replace the code from above with what's below.</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">var</span> transition = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-keyword\">var</span> dataInterpolate = d3.interpolate(generateData(), generateData()),\n      hueInterpolate = d3.interpolate(getHue(), getHue()),\n      strokeInterpolate = d3.interpolate(getStroke(), getStroke());\n\n  paths.each(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">d,i</span>) </span>{\n    <span class=\"hljs-keyword\">var</span> data = dataInterpolate(i*(<span class=\"hljs-number\">1</span>/quantity)),\n        color = hueInterpolate(i*(<span class=\"hljs-number\">1</span>/quantity)),\n        stroke = strokeInterpolate(i*(<span class=\"hljs-number\">1</span>/quantity));\n\n    d3.select(<span class=\"hljs-keyword\">this</span>)\n      .data([data])\n      .transition()\n      .duration(<span class=\"hljs-number\">3000</span>)\n      .ease(<span class=\"hljs-string\">'linear'</span>)\n      .attr(<span class=\"hljs-string\">'d'</span>, line)\n      .attr(<span class=\"hljs-string\">'stroke'</span>, <span class=\"hljs-string\">'hsla('</span>+color+<span class=\"hljs-string\">', 80%, 50%, 0.5)'</span>)\n      .attr(<span class=\"hljs-string\">'stroke-width'</span>, stroke);\n  });\n};</code></pre>\n<p>Boom! Are you confused now? Not only does d3.js support a bunch of different types of line interpolation, but it also supports <a href=\"https://github.com/mbostock/d3/wiki/Transitions#d3_interpolate\">many other types of interpolation</a> as well, between a huge variety of data types (as long as they're the same type) including, colors, numbers, strings, and even arbitrary objects. Here we are interpolating all of the things that we want to change across the different lines (datapoints, hue, and stroke).</p>\n<p>Then we use an each loop with the paths selection that we made earlier to set the data, color, and stroke for each of the lines in a way that they blend between each line instance.</p>\n<pre><code class=\"hljs language-js\">transition();\n\n<span class=\"hljs-built_in\">document</span>.onclick = transition;\n<span class=\"hljs-built_in\">document</span>.ontouchstart = transition;</code></pre>\n<p>And finally, we call the transition function to make our initial lines appear and then assign it to execute again with clicks or touches to the document.</p>\n<p>Hope you enjoyed the tutorial! <a href=\"http://tscanlin.github.io/timscanlin-demos/visualization.html\">Check out the final product</a>.</p>\n<p>Or go get the <a href=\"https://github.com/tscanlin/timscanlin-demos\">source on Github</a>.</p>\n","__filename":"posts/2014/Simple-d3-js-visualization.md","__url":"/posts/2014/Simple-d3-js-visualization/","__resourceUrl":"/posts/2014/Simple-d3-js-visualization/index.html","__dataUrl":"/posts/2014/Simple-d3-js-visualization/index.html.38597d37850963f07f2d05e0157c31b0.json"}